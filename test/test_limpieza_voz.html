<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Limpieza de Texto para Voz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <div class="container">
        <h2>üß™ Test: Limpieza de Texto para S√≠ntesis de Voz</h2>
        
        <div class="card mt-3">
            <div class="card-header bg-primary text-white">
                <strong>Texto Original (con emojis y markdown)</strong>
            </div>
            <div class="card-body" id="original-text">
                <p><strong>Cargando...</strong></p>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header bg-success text-white">
                <strong>Texto Limpio (sin emojis, sin markdown, sin s√≠mbolos)</strong>
            </div>
            <div class="card-body" id="clean-text">
                <p><strong>Cargando...</strong></p>
            </div>
        </div>
        
        <div class="mt-3">
            <button class="btn btn-primary" onclick="testSpeak()">üîä Escuchar Texto Limpio</button>
            <button class="btn btn-secondary" onclick="testOriginal()">üîä Escuchar Original (con s√≠mbolos)</button>
            <button class="btn btn-danger" onclick="stopSpeak()">‚èπÔ∏è Detener</button>
        </div>
        
        <div class="alert alert-info mt-3">
            <strong>‚úÖ Correcciones implementadas:</strong><br>
            1. "WhatsApp" cambiado a "email" / "correo electr√≥nico"<br>
            2. Limpieza autom√°tica de: emojis, **, __, ##, s√≠mbolos especiales, par√©ntesis, corchetes, etc.
        </div>
    </div>

    <script>
        const originalText = `**1Ô∏è‚É£ ADMINISTRADOR** üîë
- Gestiona usuarios, equipos y aulas
- Ve el historial global de todos
- Exporta reportes
- ‚ö†Ô∏è REQUIERE verificaci√≥n de correo (link por email)
- NO requiere verificaci√≥n SMS
- NO puede hacer reservas ni pr√©stamos

**2Ô∏è‚É£ PROFESOR** üë®‚Äçüè´
- Reserva aulas AIP
- Solicita pr√©stamos de equipos
- Ve su propio historial
- ‚ö†Ô∏è REQUIERE verificaci√≥n de correo (link por email)
- ‚ö†Ô∏è REQUIERE verificaci√≥n SMS para acciones cr√≠ticas`;

        // Funci√≥n de limpieza (igual que en tommibot.js)
        function cleanTextForSpeech(text) {
            let cleanText = text;
            
            // Eliminar emojis
            cleanText = cleanText.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]/gu, '');
            
            // Eliminar markdown
            cleanText = cleanText.replace(/\*\*/g, '');
            cleanText = cleanText.replace(/\*/g, '');
            cleanText = cleanText.replace(/\_\_/g, '');
            cleanText = cleanText.replace(/\_/g, '');
            cleanText = cleanText.replace(/\#\#\#/g, '');
            cleanText = cleanText.replace(/\#\#/g, '');
            cleanText = cleanText.replace(/\#/g, '');
            
            // Eliminar s√≠mbolos especiales
            cleanText = cleanText.replace(/[\u2713\u2714\u2705\u2611]/g, '');
            cleanText = cleanText.replace(/[\u274C\u2716\u2717\u274E]/g, '');
            cleanText = cleanText.replace(/[\u26A0\u26A1\u2B50\u2B55]/g, '');
            cleanText = cleanText.replace(/[\u{1F7E0}-\u{1F7EB}]/gu, '');
            
            // Eliminar flechas y s√≠mbolos matem√°ticos
            cleanText = cleanText.replace(/[\u2190-\u21FF]/g, '');
            cleanText = cleanText.replace(/[\u2200-\u22FF]/g, '');
            
            // Eliminar par√©ntesis y corchetes vac√≠os
            cleanText = cleanText.replace(/\(\s*\)/g, '');
            cleanText = cleanText.replace(/\[\s*\]/g, '');
            
            // Limpiar saltos de l√≠nea
            cleanText = cleanText.replace(/\n{3,}/g, '. ');
            cleanText = cleanText.replace(/\n{2}/g, '. ');
            cleanText = cleanText.replace(/\n/g, '. ');
            cleanText = cleanText.replace(/\s{2,}/g, ' ');
            
            // Eliminar bullets
            cleanText = cleanText.replace(/^[\-\‚Ä¢\*]\s*/gm, '');
            
            cleanText = cleanText.trim();
            
            return cleanText;
        }

        // Mostrar textos
        document.getElementById('original-text').innerHTML = '<pre>' + originalText + '</pre>';
        document.getElementById('clean-text').innerHTML = '<pre>' + cleanTextForSpeech(originalText) + '</pre>';

        function testSpeak() {
            const clean = cleanTextForSpeech(originalText);
            const utterance = new SpeechSynthesisUtterance(clean);
            utterance.lang = 'es-PE';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function testOriginal() {
            const utterance = new SpeechSynthesisUtterance(originalText);
            utterance.lang = 'es-PE';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function stopSpeak() {
            window.speechSynthesis.cancel();
        }
    </script>
</body>
</html>
