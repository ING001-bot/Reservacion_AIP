<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Eliminar Foto de Perfil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../Public/css/swal-custom.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../Public/js/alerts.js"></script>
    <style>
        body {
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 0 auto;
            display: block;
        }
        .profile-avatar:hover {
            transform: scale(1.05);
        }
        .test-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .test-step {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            background: #f1f3f5;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2 class="text-center mb-4">üß™ Test: Eliminar Foto de Perfil</h2>
        
        <div class="test-info">
            <h5>üìã Instrucciones de prueba:</h5>
            <div class="test-step">
                <strong>Paso 1:</strong> Observa la foto de perfil de ejemplo
            </div>
            <div class="test-step">
                <strong>Paso 2:</strong> Haz clic en el bot√≥n "üóëÔ∏è Eliminar Foto"
            </div>
            <div class="test-step">
                <strong>Paso 3:</strong> Confirma la eliminaci√≥n en el mensaje de confirmaci√≥n
            </div>
            <div class="test-step">
                <strong>Paso 4:</strong> Verifica que aparece el mensaje de "Eliminando foto..."
            </div>
            <div class="test-step">
                <strong>Paso 5:</strong> Verifica el mensaje de √©xito final
            </div>
        </div>

        <div class="text-center mb-4">
            <img src="../Public/img/default-avatar.png" 
                 alt="Foto de perfil" 
                 class="profile-avatar"
                 id="profileImage">
            <p class="mt-3 text-muted">Foto de perfil actual</p>
        </div>

        <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-danger btn-lg"
                    onclick="confirmarEliminarFoto()" id="btnEliminar">
                üóëÔ∏è Eliminar Foto
            </button>
            <button type="button" class="btn btn-secondary"
                    onclick="restaurarFoto()">
                üîÑ Restaurar foto para volver a probar
            </button>
        </div>

        <div class="alert alert-info mt-4">
            <strong>‚ÑπÔ∏è Nota:</strong> Esta es una prueba simulada. En el sistema real, 
            al confirmar se enviar√° un formulario POST al servidor para eliminar la foto 
            del sistema de archivos y actualizar la base de datos.
        </div>

        <div id="logContainer" class="mt-4">
            <h6>üìä Log de eventos:</h6>
            <div id="logContent" class="border rounded p-3" style="max-height: 200px; overflow-y: auto; background: #f8f9fa;">
                <small class="text-muted">Esperando acci√≥n...</small>
            </div>
        </div>
    </div>

    <script>
        let fotoEliminada = false;

        function addLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const colors = {
                info: '#0dcaf0',
                success: '#198754',
                warning: '#ffc107',
                error: '#dc3545'
            };
            
            const log = document.createElement('div');
            log.innerHTML = `<small><span style="color: ${colors[type]}">‚¨§</span> [${time}] ${message}</small>`;
            
            if (logContent.querySelector('.text-muted')) {
                logContent.innerHTML = '';
            }
            
            logContent.appendChild(log);
            logContent.scrollTop = logContent.scrollHeight;
        }

        async function confirmarEliminarFoto() {
            addLog('Usuario hizo clic en "Eliminar Foto"', 'info');
            
            const confirm = await showDangerConfirm(
                '¬øEliminar foto de perfil?',
                'Tu foto de perfil actual ser√° eliminada y volver√° al avatar predeterminado',
                'S√≠, eliminar'
            );
            
            if (confirm.isConfirmed) {
                addLog('Usuario confirm√≥ la eliminaci√≥n', 'warning');
                
                // Mostrar loading
                Swal.fire({
                    title: 'Eliminando foto...',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => {
                        Swal.showLoading();
                        addLog('Mostrando indicador de carga...', 'info');
                    }
                });
                
                // Simular proceso de eliminaci√≥n (en el sistema real esto ser√≠a un submit del formulario)
                setTimeout(() => {
                    fotoEliminada = true;
                    addLog('Simulando eliminaci√≥n del archivo f√≠sico...', 'info');
                    addLog('Simulando actualizaci√≥n de base de datos...', 'info');
                    
                    // Cambiar a avatar por defecto
                    document.getElementById('profileImage').src = '../Public/img/default-avatar.png';
                    document.getElementById('btnEliminar').disabled = true;
                    document.getElementById('btnEliminar').classList.add('disabled');
                    
                    addLog('Foto eliminada exitosamente', 'success');
                    
                    // Mostrar mensaje de √©xito
                    Swal.fire({
                        icon: 'success',
                        title: '¬°Foto eliminada!',
                        text: '‚úÖ Foto eliminada',
                        timer: 3000,
                        showConfirmButton: true
                    });
                }, 1500);
            } else {
                addLog('Usuario cancel√≥ la eliminaci√≥n', 'error');
            }
        }

        function restaurarFoto() {
            if (fotoEliminada) {
                document.getElementById('profileImage').src = '../Public/img/default-avatar.png';
                document.getElementById('btnEliminar').disabled = false;
                document.getElementById('btnEliminar').classList.remove('disabled');
                fotoEliminada = false;
                addLog('Foto restaurada para nueva prueba', 'success');
                
                Swal.fire({
                    icon: 'info',
                    title: 'Foto restaurada',
                    text: 'Ya puedes probar nuevamente',
                    timer: 2000,
                    showConfirmButton: false
                });
            } else {
                addLog('No hay cambios para restaurar', 'warning');
            }
        }

        // Log inicial
        document.addEventListener('DOMContentLoaded', () => {
            addLog('Test de eliminaci√≥n de foto cargado correctamente', 'success');
            addLog('Sistema listo para pruebas', 'info');
        });
    </script>
</body>
</html>
